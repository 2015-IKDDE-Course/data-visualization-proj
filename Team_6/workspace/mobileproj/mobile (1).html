<html>

<head>

	<meta charset="UTF-8" />

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.13/d3.js"></script>

	<script src="js/DataLoadM.js"></script>
	<script src="js/DataProcessM.js"></script>
	<script src="js/VagListM.js"></script>

	<script>

		var list;

		var isInSettingMode = false;
		var increaseTag = "yesterday";

		$(document).ready(function(){

			DataLoadM.loadRawText("csv/merge.csv", function(a){
				DataProcessM.processData(a, function(){}, function(){

					list = new VagListM(d3.select("#vaglist"), DataProcessM.priceList);
					list.show(increaseTag);
					list.sortByOptionAndAnimate(true, "price");

					for(var i = 0; i < DataProcessM.vagNum; i++){
						var name = DataProcessM.vagNameMap[DataProcessM.vagIdList[i]];
						var id = DataProcessM.vagIdList[i];
						$("#chooseVagetable").append("<div class='cvItem cvItemVag' data-vagid='" + id + "'>" + name + "</div>");
					}

					$(".cvItemVag").click(function(){
						var find = false;
						for(var i = 0; i < list.itemList.length; i++){
							if(list.itemList[i].id == $(this).data("vagid")){
								find = true;
							}
						}
						if(find){
							$(this).css("color", "#bbbbbb");
							list.removeItem($(this).data("vagid"));
						} else {
							$(this).css("color", "#000000");
							for(var i = 0; i < DataProcessM.vagNum; i++){
								if(DataProcessM.priceList[i].id == $(this).data("vagid")){
									list.addItem(i);
								}
							}
						}
					});

				});
			});

			$(".menuitem").click(function(){
				if($(this).data("index") == "0"){

					if(list.sortOption == "price"){
						$(this).html("改為以價格排序");
						list.sortByOptionAndAnimate(list.sortOptionBool, increaseTag);
					}else{
						$(this).html("改為以漲幅排序");
						list.sortByOptionAndAnimate(list.sortOptionBool, "price");
					}

				} else if($(this).data("index") == "1"){

					list.sortOptionBool = !list.sortOptionBool;
					list.sortByDefaultAndAnimate();

				} else if($(this).data("index") == "2"){

					if(isInSettingMode == true){
						$(".slider").css("left", "0%");
						isInSettingMode = false;
					} else {
						$(".slider").css("left", "-100%");
						isInSettingMode = true;
					}
					
				}
			});
			
			menuheight = parseInt($(".menu").css("height"));
			$("img").css("width", menuheight*0.6);
			$("img").css("height", menuheight*0.6);
			$(".settingmenu").children("img").css("margin-top", "2%");
			$(".settingmenu").css("height", menuheight);

		});

	function vagDeselectAll(){
		$(".cvItemVag").css("color", "#bbbbbb");
		for(var i = 0; i < DataProcessM.vagNum; i++){
			list.removeItem(DataProcessM.vagIdList[i]);
		}
	}

	function vagSelectAll(){
		vagDeselectAll();
		$(".cvItemVag").css("color", "#000000");
		for(var i = 0; i < DataProcessM.vagNum; i++){
			list.addItem(i);
		}
	}

	</script>

	<style>

		body {
			/*border-style: solid;*/
			margin: 0px;
			padding: 0px;
		}

		::-webkit-scrollbar {
    		display: none;
		}

		.outerborder {
			overflow: hidden;
			width: 100%;
			height: 100%;
		}

		.title {
			height: 10%;
		}

		.menu {
			height: 10%;
			white-space: nowrap;
		}

		.mainmenu {
			display: inline-block;
			height: 100%;
		}

		.settingmenu {
			display: inline-block;
			width: 100%;
		}

		.slider {
			height: 90%;
			white-space: nowrap;
			position: relative;
			/* overflow-x: hidden; */

			left: 0%;
			transition: left 0.6s;
			transition-timing-function: ease-out;
		}

		.panel {
			overflow-y: scroll;

			display: inline-block;
			width: 100%;
			height: 100%;
		}

		img {
			display: block;
			margin: auto;
			margin-top: 5%;
			/*margin-right: auto;*/
		}

		#vaglist {
			width: 100%;
		}

		div > * {
	    	vertical-align:middle;
		}

	</style>

</head>

<body>

	<div class="outerborder">

		<div class="title">
		</div>

		<div class="slider">

			<div class="panel">

				<div class="menu">
					<div class="menuitem mainmenu" data-index="0" style="width: 40%">
						改為以漲幅排序
					</div>
					<div class="menuitem mainmenu" data-index="1" style="width: 40%">
						降序升序
					</div>
					<div class="menuitem mainmenu" data-index="2" style="width: 20%">
						<img src="img/settings.png"/>
					</div>
				</div>

				<svg id="vaglist"></svg>

			</div>

			<div class="panel">
				
				<div class="menuitem settingmenu" data-index="2">
					<img src="img/back.png"/>
				</div>

				<div id="setIntreaseTag">
					<div> 與什麼比較漲跌幅？ </div>
					<div class="sitItem">昨日價格</div>
					<div class="sitItem">近十日價格平均</div>
					<div class="sitItem">近三十日價格平均</div>
				</div>

				<div id="chooseVagetable">
					<div> 選擇蔬菜 </div>
					<div class="cvItem" onclick="vagSelectAll();"> 選擇全部 </div>
					<div class="cvItem" onclick="vagDeselectAll();"> 清除全部 </div>
				</div>

			</div>
				
		</div>

	</div>

</body>

</html>
