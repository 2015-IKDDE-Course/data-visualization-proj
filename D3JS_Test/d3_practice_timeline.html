<html>

<head>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
	<script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
	<script src="https://cdn.firebase.com/js/client/2.3.1/firebase.js"></script>

	<script>

		function getPriceDiff(index, time){
			return Math.sin(((index * index % 20) / 2 + 1) * time / 20) * 50;
		}

		var cenX = 20;
		var cenY = 200;
		var dX = 2;
		var dY = 1;
		var sclX = 25;

		$().ready(function (){

			var svgSection = d3
				.select(".datavis")
				.append("svg")
				.attr("width", 1200)
				.attr("height", 900);

			var color = d3.scale.category20();

			var index = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19];

			var time = 0;

			var groupSections = svgSection
				.selectAll("g")
				.data(index)
				.enter() 
				.append("g")
				.attr("transform", function (d) {
					return "translate(" + ((20-d) * sclX - time * dX + cenX) + ", " + (50 - time * dY + cenY) + ")";
				});

			var linesegInGroup = groupSections
				.append("line")
				.attr("x1", function (d) { return ((20-d) * sclX + (time-1) * dX + cenX); })
				.attr("y1", function (d) { return (50 + (time-1) * dY + cenY - getPriceDiff((20-d), time-1)); })
				.attr("x2", function (d) { return ((20-d) * sclX + time * dX + cenX); })
				.attr("y2", function (d) { return (50 + time * dY + cenY - getPriceDiff((20-d), time)); })
				.style("stroke", function(d) {
					return color(d, 0);
				})
				.style("stroke-width", 2)
				.style("stroke-opacity", 0.2);

			var indicatorLine = groupSections
				.append("line")
				.attr("x1", function (d) { return ((20-d) * sclX + time * dX + cenX); })
				.attr("y1", function (d) { return (50 + time * dY + cenY); })
				.attr("x2", function (d) { return ((20-d) * sclX + time * dX + cenX); })
				.attr("y2", function (d) { return (50 + time * dY + cenY - getPriceDiff((20-d), time)); })
				.style("stroke", function(d) {
					return color(d, 0);
				})
				.style("stroke-width", 5);


			setInterval(function () {

				time++;

				groupSections
					.append("line")
					.attr("x1", function (d) { return ((20-d) * sclX + (time-1) * dX + cenX); })
					.attr("y1", function (d) { return (50 + (time-1) * dY + cenY - getPriceDiff((20-d), time-1)); })
					.attr("x2", function (d) { return ((20-d) * sclX + time * dX + cenX); })
					.attr("y2", function (d) { return (50 + time * dY + cenY - getPriceDiff((20-d), time)); })
					.style("stroke", function(d) {
							return color(d, 0);
					})
					.style("stroke-width", 2)
					.style("stroke-opacity", 0.4);

				indicatorLine
					.transition()
					.attr("x1", function (d) { return ((20-d) * sclX + time * dX + cenX); })
					.attr("y1", function (d) { return (50 + time * dY + cenY); })
					.attr("x2", function (d) { return ((20-d) * sclX + time * dX + cenX); })
					.attr("y2", function (d) { return (50 + time * dY + cenY - getPriceDiff((20-d), time)); })
					.duration(200);

				groupSections
					.transition()
					.attr("transform", function (d) {
						return "translate(" + ((20-d) * sclX - time * dX + cenX) + ", " + (50 - time * dY + cenY) + ")";
					})
					.duration(200);
				
				$("#date").html(time);

			}, 200);

		});

	</script>
</head>

<body>
date <span id="date"></span><br>
<div class="datavis"></div>
</body>

</html>
